(function($){$.fn.hasAttr=function(name){return this.attr(name)!==undefined}})(jQuery);function ModalRemote(modalId){this.defauls={okLabel:"OK",cancelLabel:"Cancel",loadingTitle:"Loading"};this.modal=$(modalId);this.dialog-$(modalId).find(".modal-dialog");this.header=$(modalId).find(".modal-header");this.content=$(modalId).find(".modal-body");this.footer=$(modalId).find(".modal-footer");this.loadingContent='<div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div>';this.show=function(){this.clear();$(this.modal).modal("show")};this.hide=function(){$(this.modal).modal("hide")};this.toggle=function(){$(this.modal).modal("toggle")};this.clear=function(){$(this.modal).find(".modal-title").remove();$(this.content).html("");$(this.footer).html("")};this.setHeader=function(content){$(this.header).html(content)};this.setContent=function(content){$(this.content).html(content)};this.setFooter=function(content){$(this.footer).html(content)};this.setTitle=function(title){$(this.header).find("h4.modal-title").remove();$(this.header).append('<h4 class="modal-title">'+title+"</h4>")};this.hidenCloseButton=function(){$(this.header).find("button.close").hide()};this.showCloseButton=function(){$(this.header).find("button.close").show()};this.addButton=function(label,classes,callback){buttonElm=document.createElement("button");buttonElm.setAttribute("class",classes===null?"btn btn-primary":classes);buttonElm.innerHTML=label;var instance=this;$(this.footer).append(buttonElm);if(callback!==null){$(buttonElm).click(function(event){callback.call(instance,this,event)})}};this.displayLoading=function(){this.setContent(this.loadingContent);this.setTitle(this.defauls.loadingTitle)};this.confirm=function(title,message,okLabel,cancelLabel,okCallback,cancelCallback){if(title!==undefined){this.setTitle(title)}if(message!==undefined){this.setContent(message)}this.addButton(okLabel===undefined?this.defauls.okLabel:okLabel,"btn btn-primary",okCallback);this.addButton(cancelLabel===undefined?this.defauls.cancelLabel:cancelLabel,"btn btn-default pull-left",cancelCallback)};this.setSize=function(size){$(this.dialog).removeClass("modal-lg");$(this.dialog).removeClass("modal-sm");if(size=="large")$(this.dialog).addClass("modal-lg");else if(size=="small")$(this.dialog).addClass("modal-sm");else if(size!=="normal")console.warn("Not define size"+size)};this.remote=function(elm,bulkData){var url=$(elm).hasAttr("href")?$(elm).attr("href"):$(elm).attr("data-url");var method=$(elm).hasAttr("data-request-method")?$(elm).attr("data-request-method"):"GET";var size=$(elm).hasAttr("data-modal-size")?$(elm).attr("data-modal-size"):"normal";if($(elm).hasAttr("data-confirm-title")||$(elm).hasAttr("data-confirm-message")){this.show();this.setSize(size);var instance=this;this.confirm($(elm).attr("data-confirm-title"),$(elm).attr("data-confirm-message"),$(elm).attr("data-confirm-ok"),$(elm).attr("data-confirm-cancel"),function(e){doRemote.call(instance,url,method,bulkData)},function(e){this.hide()})}else{doRemote.call(this,url,method,bulkData)}};function doRemote(url,method,bulkData){var instance=this;$.ajax({url:url,method:method,data:bulkData,beforeSend:function(){beforeRemoteRequest.call(instance)},error:function(response){errorRemoteResponse.call(instance,response)},success:function(response){successRemoteResponse.call(instance,response)}})}function beforeRemoteRequest(){this.show();this.displayLoading()}function errorRemoteResponse(response){this.setTitle(response.status+response.statusText);this.setContent(response.responseText);this.addButton("Close","btn btn-default",function(button,event){this.hide()})}function successRemoteResponse(response){var contenedor="#crud-datatable-pjax";if(response.contenedorId!==undefined&&response.contenedorId){contenedor=response.contenedorId;$.ajax({url:response.contenedorUrl}).done(function(data){$(contenedor).html($.parseJSON(data))})}else{if(response.forceReload!==undefined&&response.forceReload){$.pjax.reload({container:contenedor})}}if(response.forceClose!==undefined&&response.forceClose){this.hide();return}if(response.size!==undefined)this.setSize(response.size);if(response.title!==undefined)this.setTitle(response.title);if(response.content!==undefined)this.setContent(response.content);if(response.footer!==undefined)this.setFooter(response.footer);if($(this.content).find("form")[0]!==undefined){var modalForm=$(this.content).find("form")[0];var modalFormSubmitBtn=$(this.footer).find('[type="submit"]')[0];if(modalFormSubmitBtn===undefined){console.warn("Modal have form but have not any submit button")}else{var instance=this;$(modalFormSubmitBtn).click(function(e){var url=$(modalForm).attr("action");var method=$(modalForm).hasAttr("method")?$(modalForm).attr("method"):"GET";var data=$(modalForm).serializeArray();$.ajax({url:url,method:method,data:data,beforeSend:function(){beforeRemoteRequest.call(instance)},error:function(response){errorRemoteResponse.call(instance,response)},success:function(response){successRemoteResponse.call(instance,response)}})})}}}}